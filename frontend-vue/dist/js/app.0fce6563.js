(function(){"use strict";var e={698:function(e,t,n){var o=n(963),a=n(252);function i(e,t,n,o,i,r){const s=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(s)])}var r={created(){console.log("App.vue created")},mounted(){console.log("App.vue mounted"),console.log("Element with id 'app' exists:",document.getElementById("app"))}},s=n(744);const l=(0,s.Z)(r,[["render",i]]);var c=l,d=n(201);const u={class:"container"},m={class:"delayed"},p=(0,a._)("h1",null,"Försenade tåg",-1),h={class:"main-delayed-trains",ref:"mainDelayedTrains"},f={class:"map",ref:"map"};function k(e,t,n,o,i,r){const s=(0,a.up)("render-delayed-table");return(0,a.wg)(),(0,a.iD)("div",u,[(0,a._)("div",m,[p,(0,a._)("div",h,null,512),(0,a.Wm)(s,{data:i.delayedData},null,8,["data"])]),(0,a._)("div",f,null,512)])}var w=n(920),v=n(243),g=n.n(v),y=n(577);const b={class:"delayed-trains",ref:"delayedTrains",id:"delayed-trains"},T=["onClick"],_={class:"train-number"},D={class:"current-station"},I=["onClick"],C={key:0,class:"modal-container"},L={class:"modal",id:"train-modal"},z={key:0},O=(0,a._)("strong",null,"Orsakskod:",-1),V=(0,a._)("br",null,null,-1),R=(0,a._)("strong",null,"Tågnummer:",-1),A=(0,a._)("br",null,null,-1),S=(0,a._)("strong",null,"Tågdatum:",-1),j={key:1},M={key:2},x=(0,a._)("strong",null,"Försenad:",-1),E={key:3},N=(0,a._)("strong",null,"Advertised Time:",-1),U=(0,a._)("label",{for:"reason-code"},"Orsakskod",-1),F=(0,a._)("br",null,null,-1),Z=(0,a._)("br",null,null,-1),P=(0,a._)("br",null,null,-1),H=(0,a._)("input",{type:"submit",value:"Skapa nytt ärende"},null,-1);function q(e,t,n,i,r,s){const l=(0,a.up)("reason-codes");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("h2",null,"Total Delays: "+(0,y.zw)(n.data.length),1),(0,a._)("div",b,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.data,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t,onClick:t=>s.openTicketView(e),class:"train-item"},[(0,a._)("div",_,(0,y.zw)(e.OperationalTrainNumber),1),(0,a._)("div",D,[(0,a._)("div",null,(0,y.zw)(e.LocationSignature),1),(0,a._)("div",null,(0,y.zw)(e.FromLocation?e.FromLocation[0].LocationName+" -> ":"")+" "+(0,y.zw)(e.ToLocation?e.ToLocation[0].LocationName:""),1)]),(0,a._)("button",{onClick:t=>s.openTicketView(e)},"Open Errand",8,I)],8,T)))),128))],512),r.showTicketView?((0,a.wg)(),(0,a.iD)("div",C,[(0,a._)("div",L,[(0,a._)("button",{onClick:t[0]||(t[0]=(...e)=>s.closeTicketView&&s.closeTicketView(...e)),id:"back"},"Close Ticket"),(0,a._)("button",{onClick:t[1]||(t[1]=t=>e.editTicket(e.item))},"Edit"),(0,a._)("button",{onClick:t[2]||(t[2]=t=>e.deleteTicket(e.item._id))},"Delete"),(0,a._)("h1",null,"Nytt ärende #"+(0,y.zw)(r.selectedItem.ActivityId),1),r.selectedItem?((0,a.wg)(),(0,a.iD)("ul",z,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.tickets,(e=>((0,a.wg)(),(0,a.iD)("li",{key:e._id},[O,(0,a.Uk)(" "+(0,y.zw)(e.code),1),V,R,(0,a.Uk)(" "+(0,y.zw)(e.trainnumber),1),A,S,(0,a.Uk)(" "+(0,y.zw)(e.traindate),1)])))),128))])):(0,a.kq)("",!0),r.selectedItem&&r.selectedItem.FromLocation?((0,a.wg)(),(0,a.iD)("h3",j," Tåg från "+(0,y.zw)(r.selectedItem.FromLocation[0].LocationName)+" till "+(0,y.zw)(r.selectedItem.ToLocation[0].LocationName)+". Just nu i "+(0,y.zw)(r.selectedItem.LocationSignature)+". ",1)):(0,a.kq)("",!0),r.selectedItem?((0,a.wg)(),(0,a.iD)("p",M,[x,(0,a.Uk)(" "+(0,y.zw)(s.outputDelay(r.selectedItem)),1)])):(0,a.kq)("",!0),r.selectedItem?((0,a.wg)(),(0,a.iD)("p",E,[N,(0,a.Uk)(" "+(0,y.zw)(r.selectedItem.AdvertisedTimeAtLocation),1)])):(0,a.kq)("",!0),(0,a._)("form",{onSubmit:t[4]||(t[4]=(0,o.iM)(((...e)=>s.createTicket&&s.createTicket(...e)),["prevent"]))},[U,F,(0,a.Wm)(l,{modelValue:r.selectedReason,"onUpdate:modelValue":t[3]||(t[3]=e=>r.selectedReason=e),reasonCodes:r.reasonCodes},null,8,["modelValue","reasonCodes"]),Z,P,H],32)])])):(0,a.kq)("",!0)],64)}const Y=["value"];function K(e,t,n,i,r,s){return(0,a.wy)(((0,a.wg)(),(0,a.iD)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.selectedReason=e)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.reasonCodes,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.Code,value:e.Code},(0,y.zw)(e.Level1Description)+" - "+(0,y.zw)(e.Level2Description)+" - "+(0,y.zw)(e.Level3Description),9,Y)))),128))],512)),[[o.bM,r.selectedReason]])}var W={data(){return{selectedReason:null,reasonCodes:[]}},mounted(){fetch("https://jsramverk-train-adde22anbx22.azurewebsites.net/codes").then((e=>e.json())).then((e=>{this.reasonCodes=e.data,this.reasonCodes.length>0&&(this.selectedReason=this.reasonCodes[0].Code)})).catch((e=>{console.error("Error fetching reason codes:",e)}))}};const $=(0,s.Z)(W,[["render",K]]);var B=$,J=n(154),G={data(){return{showTicketView:!1,selectedItem:null,selectedReason:null,reasonCodes:[],tickets:[],createdTicket:null}},props:{data:Array},components:{ReasonCodes:B},methods:{async openTicketView(e){this.selectedItem=e,this.selectedItem.trainNumber=e.OperationalTrainNumber,this.selectedItem.trainDate=e.AdvertisedTimeAtLocation,this.selectedItem.activityId=e.ActivityId,this.showTicketView=!0;try{const e=await J.Z.get("https://localhost:1337/tickets");200===e.status?this.tickets=e.data.data:console.error("Failed to fetch ticket data:",e.status)}catch(t){console.error("Error fetching ticket data:",t)}this.showTicketView=!0},closeTicketView(){this.showTicketView=!1},outputDelay(e){const t=new Date(e.AdvertisedTimeAtLocation),n=new Date(e.EstimatedTimeAtLocation),o=Math.abs(n-t);return Math.floor(o/6e4)+" minuter"},async createTicket(){if(!this.selectedReason)return void alert("Please select a reason code.");const e={code:this.selectedReason,trainnumber:this.selectedItem.trainNumber,traindate:this.selectedItem.trainDate,activityId:this.selectedItem.activityId};console.log("ticketData:",e);try{const t=await J.Z.post("https:https://localhost:3000/tickets",e,{validateStatus:function(e){return console.log("Response Status Code:",e),e>=200&&e<300}});console.log("Response Data:",t.data),console.log("Response Headers:",t.headers),200===t.status?(this.createdTicket={code:t.data.code,trainnumber:t.data.trainnumber,traindate:t.data.traindate,activityId:t.data.activityId},alert("Ticket created successfully")):(console.error("Unexpected response status:",t.status),console.log("Response Data:",t.data))}catch(t){console.error("Error creating ticket:",t),console.log("Response Data:",t.response.data)}}}};const Q=(0,s.Z)(G,[["render",q]]);var X=Q,ee={data(){return{markers:{},delayedData:[]}},mounted(){this.renderMainView()},methods:{renderMainView(){const e=this.$refs.mainDelayedTrains;e.innerHTML="";const t=g().map(this.$refs.map).setView([62.173276,14.942265],5);g().tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(t);const o=(0,w.ZP)("http://localhost:1337");o.on("message",(e=>{if(e.trainnumber in this.markers){let t=this.markers[e.trainnumber];t.setLatLng(e.position)}else{const o=g().icon({iconUrl:n(93),iconRetinaUrl:n(431),iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]});let a=g().marker(e.position,{icon:o}).bindPopup(e.trainnumber).addTo(t);this.markers[e.trainnumber]=a}})),fetch("http://localhost:1337/delayed").then((e=>e.json())).then((e=>{this.delayedData=e.data}))}},components:{"render-delayed-table":X}};const te=(0,s.Z)(ee,[["render",k]]);var ne=te;const oe=[{path:"/",name:"main",component:ne}],ae=(0,d.p7)({history:(0,d.r5)(),routes:oe});ae.beforeEach(((e,t,n)=>{console.log("Navigating to:",e.path),n()}));var ie=ae;const re=(0,o.ri)(c);re.use(ie),re.mount("#app")}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,o,a,i){if(!o){var r=1/0;for(d=0;d<e.length;d++){o=e[d][0],a=e[d][1],i=e[d][2];for(var s=!0,l=0;l<o.length;l++)(!1&i||r>=i)&&Object.keys(n.O).every((function(e){return n.O[e](o[l])}))?o.splice(l--,1):(s=!1,i<r&&(r=i));if(s){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,a,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,i,r=o[0],s=o[1],l=o[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(l)var d=l(n)}for(t&&t(o);c<r.length;c++)i=r[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},o=self["webpackChunktrain_controller_2_0"]=self["webpackChunktrain_controller_2_0"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(698)}));o=n.O(o)})();
//# sourceMappingURL=app.0fce6563.js.map